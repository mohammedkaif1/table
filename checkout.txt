import React, { useState, useEffect } from 'react';
import {
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  Paper, Checkbox, Dialog, DialogActions, DialogContent, DialogTitle,
  Button, Typography
} from '@mui/material';
import { styled } from '@mui/system';

const StyledTableRow = styled(TableRow)(({ theme }) => ({
  '&:nth-of-type(odd)': {
    //backgroundColor: theme.palette.action.hover,
  },
  '&:hover': {
    //backgroundColor: theme.palette.action.selected,
  },
  height: '60px',
}));

const StyledButton = styled(Button)({
  backgroundColor: '#6f4c8e',
  color: '#ffffff',
  '&:hover': {
    backgroundColor: '#5a3b70',
  },
});

const Checkout = ({ data, open, close }) => {
  const [selected, setSelected] = useState({});

  // Initialize selected state when data changes
  useEffect(() => {
    const initialSelected = {};
    data.forEach(emp => {
      initialSelected[emp.employeeId] = true; // Default all checkboxes to checked
    });
    setSelected(initialSelected);
  }, [data]);

  const handleCheckboxChange = (employeeId) => {
    setSelected(prevSelected => ({
      ...prevSelected,
      [employeeId]: !prevSelected[employeeId] // Toggle checkbox state
    }));
  };

  const handleSave = () => {
    const selectedEmployees = data.filter(emp => selected[emp.employeeId]);
    const result = selectedEmployees.map(emp => ({
      empId: emp.employeeId,
      status: emp.category,
    }));
    console.log(result);
    close();
  };

  return (
    <Dialog open={open} maxWidth="md" fullWidth>
      <DialogTitle>Checkout for Hiring Employees</DialogTitle>
      <DialogContent>
        <TableContainer component={Paper}>
          <Table>
            <TableHead>
              <TableRow>
                <TableCell>Emp ID</TableCell>
                <TableCell>Emp Name</TableCell>
                <TableCell>SDM</TableCell>
                <TableCell>Project Duration</TableCell>
                <TableCell>Skills</TableCell>
                <TableCell>Experience</TableCell>
                <TableCell>Location</TableCell>
                <TableCell>Status</TableCell>
                <TableCell>Category</TableCell>
                <TableCell>Remove</TableCell>
              </TableRow>
            </TableHead>
            <TableBody>
              {data.map((emp) => (
                <StyledTableRow key={emp.employeeId}>
                  <TableCell>{emp.employeeId}</TableCell>
                  <TableCell>{emp.employeeName}</TableCell>
                  <TableCell>{emp.sdm}</TableCell>
                  <TableCell>{emp.duration}</TableCell>
                  <TableCell>{emp.skills}</TableCell>
                  <TableCell>{emp.experience}</TableCell>
                  <TableCell>{emp.location}</TableCell>
                  <TableCell>{emp.contingencyStatus}</TableCell>
                  <TableCell>{emp.category}</TableCell>
                  <TableCell>
                    <Checkbox
                      checked={selected[emp.employeeId]}
                      onChange={() => handleCheckboxChange(emp.employeeId)}
                    />
                  </TableCell>
                </StyledTableRow>
              ))}
            </TableBody>
          </Table>
        </TableContainer>
        <Typography variant="body2" style={{ marginTop: '16px' }}>
          You have selected {Object.values(selected).filter(v => v).length} employees.
        </Typography>
      </DialogContent>
      <DialogActions>
        <Button onClick={close} color="primary">
          Cancel
        </Button>
        <StyledButton onClick={handleSave}>
          Save
        </StyledButton>
      </DialogActions>
    </Dialog>
  );
};

export default Checkout;
